# Spring Boot 后端服务器启动说明

## ⚠️ 重要提示

**如果编译失败，提示找不到 getter/setter 方法，请设置 JAVA_HOME 环境变量：**

```bash
# macOS 上设置 Java 17
export JAVA_HOME=$(/usr/libexec/java_home -v 17)

# 或者如果安装了其他版本的 Java 17，使用完整路径
# export JAVA_HOME=/path/to/java17

# 然后重新编译
mvn clean compile
```

**原因**：Maven 默认使用的 Java 版本（如 Java 24）可能与 Lombok 1.18.30 不兼容，需要明确指定 Java 17。

## 项目简介

这是沙县ERP系统的 Spring Boot 版本后端服务，使用 Java 17 + Spring Boot 3.2.0 + MySQL 数据库。

## 环境要求

- JDK 17 或更高版本
- Maven 3.6+
- MySQL 5.7+ 或 MySQL 8.0+
- 数据库 `shaxian_erp` 已创建（使用 `database/schema.sql` 初始化）

## 配置说明

### 1. 数据库配置

编辑 `src/main/resources/application.yml` 文件，修改数据库连接信息：

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/shaxian_erp?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai
    username: root
    password: your_password  # 修改为你的数据库密码
```

### 2. 端口配置

默认端口为 3000，可在 `application.yml` 中修改：

```yaml
server:
  port: 3000
```

## 启动步骤

### 方法 1: 使用 Maven 命令（推荐）

```bash
cd server-springboot
mvn spring-boot:run
```

### 方法 2: 打包后运行

```bash
cd server-springboot
mvn clean package
java -jar target/shaxian-api-1.0.0.jar
```

### 方法 3: 使用 IDE

1. 使用 IntelliJ IDEA 或 Eclipse 导入项目
2. 找到 `ShaxianApplication.java` 主类
3. 右键运行 `main` 方法

## 验证服务器运行

启动后，你应该看到：

```
Started ShaxianApplication in X.XXX seconds
```

打开浏览器访问：`http://localhost:3000/health`

应该看到：
```json
{
  "status": "ok",
  "timestamp": "2024-01-01T12:00:00"
}
```

## API 端点

所有 API 端点都以 `/api` 开头：

- `GET /health` - 健康检查
- `GET /api/products` - 获取所有商品
- `GET /api/contacts/customers` - 获取所有客户
- `GET /api/contacts/suppliers` - 获取所有供应商
- `GET /api/purchases` - 获取所有进货单
- `GET /api/sales` - 获取所有销售单
- `GET /api/dyeing` - 获取所有染色加工单
- `GET /api/accounts/receivables` - 获取应收账款
- `GET /api/accounts/payables` - 获取应付账款
- `GET /api/inventory/adjustments` - 获取库存调整单
- `GET /api/settings/store` - 获取门店信息
- `GET /api/templates` - 获取打印模板

## 常见问题

### 1. 端口被占用

如果 3000 端口被占用，修改 `application.yml` 中的 `server.port` 配置。

### 2. 数据库连接失败

- 检查 MySQL 是否运行：`mysql -u root -p`
- 检查数据库 `shaxian_erp` 是否已创建
- 检查 `application.yml` 中的数据库配置是否正确
- 确保数据库用户有足够的权限

### 3. 编译错误

确保使用 JDK 17：
```bash
java -version
```

如果版本不对，请安装 JDK 17 并配置环境变量。

### 4. Maven 依赖下载失败

如果 Maven 依赖下载失败，可以尝试：
- 配置国内镜像源（阿里云、腾讯云等）
- 检查网络连接
- 清理 Maven 缓存：`mvn clean`

## 开发模式

Spring Boot DevTools 已配置，支持热重载。修改代码后会自动重启应用。

## 停止服务器

按 `Ctrl + C` 停止服务器。

## 项目结构

```
server-springboot/
├── src/
│   ├── main/
│   │   ├── java/com/shaxian/
│   │   │   ├── ShaxianApplication.java      # 主启动类
│   │   │   ├── config/                      # 配置类
│   │   │   │   ├── WebConfig.java           # Web配置（CORS等）
│   │   │   │   └── GlobalExceptionHandler.java  # 全局异常处理
│   │   │   ├── controller/                  # 控制器层
│   │   │   │   ├── HealthController.java
│   │   │   │   ├── ProductController.java
│   │   │   │   ├── ContactController.java
│   │   │   │   └── PurchaseController.java
│   │   │   ├── service/                     # 服务层
│   │   │   │   ├── ProductService.java
│   │   │   │   └── PurchaseService.java
│   │   │   ├── repository/                  # 数据访问层
│   │   │   │   ├── ProductRepository.java
│   │   │   │   └── ...
│   │   │   ├── entity/                      # 实体类
│   │   │   │   ├── Product.java
│   │   │   │   ├── Customer.java
│   │   │   │   └── ...
│   │   │   └── util/                        # 工具类
│   │   │       ├── UuidUtil.java
│   │   │       └── OrderNumberGenerator.java
│   │   └── resources/
│   │       └── application.yml              # 配置文件
│   └── test/                                 # 测试代码
└── pom.xml                                   # Maven 配置文件
```

## 注意事项

1. 本项目使用 JPA/Hibernate，数据库表结构由 `database/schema.sql` 创建
2. JPA 配置为 `ddl-auto: none`，不会自动创建表结构
3. 所有实体类使用 `@PrePersist` 和 `@PreUpdate` 自动设置时间戳
4. UUID 使用 Java 标准库生成
5. 订单号使用工具类 `OrderNumberGenerator` 生成

## 已实现的功能模块

✅ **所有模块已完成实现**：

- ✅ 商品管理（Product）- 包括商品、色号、缸号的完整 CRUD
- ✅ 客户和供应商管理（Contact）- 客户和供应商的完整管理
- ✅ 进货单管理（Purchase）- 进货单及明细的完整管理
- ✅ 销售单管理（Sales）- 销售单及明细的完整管理，支持库存扣减
- ✅ 染色加工单管理（Dyeing）- 染色加工单及明细的完整管理
- ✅ 账款管理（Accounts）- 应收账款、应付账款、收款记录、付款记录
- ✅ 库存管理（Inventory）- 库存调整单、盘点单的完整管理
- ✅ 系统设置（Settings）- 门店信息、员工管理、角色管理、自定义查询、库存预警设置、系统参数
- ✅ 打印模板管理（Templates）- 打印模板的完整 CRUD 和使用统计

所有 API 端点都已实现，功能完整，可以直接使用。

