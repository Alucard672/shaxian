# 启动后端服务器指南

## 问题说明

当前前端应用已迁移到使用 API 调用，但后端服务器未运行，导致出现 `ERR_CONNECTION_REFUSED` 错误。

## 快速启动步骤

### 1. 安装后端依赖

```bash
cd server
npm install
```

### 2. 配置环境变量

```bash
# 复制环境变量示例文件
cp .env.example .env

# 编辑 .env 文件，配置数据库连接信息
# 默认配置：
# DB_HOST=localhost
# DB_PORT=3306
# DB_USER=root
# DB_PASSWORD=your_password
# DB_NAME=shaxian_erp
```

### 3. 创建数据库

```bash
# 连接到 MySQL
mysql -u root -p

# 创建数据库
CREATE DATABASE shaxian_erp CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
EXIT;

# 导入数据库结构
mysql -u root -p shaxian_erp < ../database/schema.sql
```

### 4. 启动后端服务器

```bash
# 开发模式（自动重启）
npm run dev

# 或生产模式
npm start
```

后端服务器将在 `http://localhost:3000` 启动。

### 5. 验证服务器运行

打开浏览器访问：`http://localhost:3000/health`

应该看到：
```json
{
  "status": "ok",
  "timestamp": "..."
}
```

## 注意事项

1. **数据库必须先创建**：确保 MySQL 已安装并运行
2. **端口冲突**：如果 3000 端口被占用，可以在 `.env` 文件中修改 `PORT` 变量
3. **CORS 配置**：后端已配置 CORS，允许前端跨域请求

## 临时解决方案

如果暂时不想启动后端服务器，可以：

1. 前端会显示错误提示，但不会崩溃
2. 所有数据操作会失败，但界面可以正常显示
3. 建议尽快启动后端服务器以使用完整功能

## 故障排查

### 问题：无法连接到数据库
- 检查 MySQL 服务是否运行
- 检查 `.env` 文件中的数据库配置是否正确
- 检查数据库用户权限

### 问题：端口被占用
- 修改 `.env` 文件中的 `PORT` 变量
- 或停止占用 3000 端口的其他服务

### 问题：API 路由返回 404
- 检查 `server/src/routes/` 目录下的路由文件是否存在
- 检查 `server/src/index.js` 中的路由注册是否正确


