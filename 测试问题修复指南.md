# 测试问题修复指南

## 问题分析

测试结果显示"用户不存在"，这是因为数据库中缺少测试账号。需要执行以下步骤：

## 修复步骤

### 1. 执行数据库迁移（添加password字段）

```bash
mysql -u root -p shaxian_erp < database/migration_add_password.sql
```

或者手动执行：

```sql
USE shaxian_erp;

-- 添加password字段（如果已存在会报错，可以忽略）
ALTER TABLE employees 
ADD COLUMN password VARCHAR(255) NULL AFTER role;

-- 更新现有员工的默认密码为123456
UPDATE employees SET password = '123456' WHERE password IS NULL OR password = '';
```

### 2. 初始化测试用户账号

```bash
mysql -u root -p shaxian_erp < database/init_test_user_simple.sql
```

或者手动执行：

```sql
USE shaxian_erp;

-- 添加password字段（如果已存在会报错，可以忽略）
ALTER TABLE employees ADD COLUMN password VARCHAR(255) NULL AFTER role;

-- 插入或更新测试管理员账号
INSERT INTO employees (id, name, phone, role, password, status, created_at, updated_at) 
VALUES ('emp-admin-001', '系统管理员', '13800138000', 'role-boss', '123456', 'active', NOW(), NOW())
ON DUPLICATE KEY UPDATE 
    password = '123456',
    status = 'active',
    updated_at = NOW();

-- 验证插入结果
SELECT id, name, phone, role, password, status FROM employees WHERE phone = '13800138000';
```

### 3. 验证测试用户

```sql
SELECT * FROM employees WHERE phone = '13800138000';
```

应该看到：
- id: emp-admin-001
- name: 系统管理员
- phone: 13800138000
- password: 123456
- status: active

### 4. 重新运行测试

```bash
npm run test:auth
```

## 已修复的问题

### ✅ AuthController空参数验证
- 现在会检查空字符串（之前只检查null）
- 空参数会返回400状态码和"不能为空"消息

### ✅ 测试脚本改进
- 测试2（错误密码）现在会检测用户是否存在
- 如果用户不存在，会给出明确的提示

## 测试账号信息

- **手机号**: `13800138000`
- **密码**: `123456`
- **角色**: `role-boss` (老板/系统管理员)

## 预期测试结果

执行完上述步骤后，所有5个测试应该通过：

1. ✅ 后端服务健康检查
2. ✅ 使用默认密码123456登录
3. ✅ 错误密码被正确拒绝
4. ✅ 不存在的用户被正确拒绝
5. ✅ 空参数被正确拒绝

