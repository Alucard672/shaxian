# 数据存储说明

## 数据存储方式

本项目使用 **浏览器的 localStorage** 来存储所有业务数据，包括：

- 商品、色号、缸号
- 客户、供应商
- 进货单、销售单、染色单
- 账款记录
- 库存调整、盘点单
- 打印模板
- 系统设置

### 存储位置

数据存储在浏览器的 **localStorage** 中，每个浏览器（或微信浏览器）都有独立的存储空间。

### 存储格式

数据以 JSON 格式存储在 localStorage 中，每个模块使用不同的 key：

```javascript
// 示例：商品数据
localStorage.setItem('products', JSON.stringify([...]))
localStorage.setItem('colors', JSON.stringify([...]))
localStorage.setItem('batches', JSON.stringify([...]))
```

## 为什么微信浏览器还有硬编码数据？

### 可能的原因

1. **微信浏览器的 localStorage 中有旧数据**
   - 之前访问过旧版本，数据已经存储在微信浏览器的 localStorage 中
   - 即使代码已经更新，localStorage 中的数据仍然存在

2. **代码未重新部署**
   - 线上部署的代码可能不是最新版本
   - 需要重新触发 GitHub Actions 部署

3. **浏览器缓存**
   - 微信浏览器可能缓存了旧版本的 JavaScript 文件

## 解决方案

### 方案 1：清除微信浏览器的 localStorage（推荐）

#### 方法 A：通过系统设置清除（最简单）

1. 打开微信
2. 进入 **设置** > **通用** > **存储空间**
3. 点击 **清理缓存**
4. 重新打开项目链接

#### 方法 B：通过项目内的清除数据功能

1. 访问项目：`https://alucard672.github.io/shaxian/`
2. 进入 **系统设置** > **清除数据**
3. 点击 **清除所有数据** 按钮
4. 刷新页面

#### 方法 C：通过浏览器控制台清除（需要电脑操作）

如果可以在电脑上打开微信开发者工具：

1. 打开微信开发者工具
2. 在控制台输入以下代码并回车：

```javascript
// 清除所有业务数据
localStorage.clear()
location.reload()
```

### 方案 2：重新部署最新代码

确保线上代码是最新版本：

1. 检查 GitHub Actions 是否已成功部署最新代码
2. 访问：https://github.com/Alucard672/shaxian/actions
3. 查看最新的部署工作流是否成功
4. 如果失败，手动触发部署：
   - 进入 Actions 页面
   - 选择 "Deploy to GitHub Pages" 工作流
   - 点击 "Run workflow"

### 方案 3：强制刷新（清除缓存）

在微信浏览器中：

1. 长按页面
2. 选择 **刷新** 或 **重新加载**
3. 或者关闭微信，重新打开

## 验证数据是否已清除

清除数据后，检查以下页面应该显示为空：

- ✅ 商品管理：无商品列表
- ✅ 销售单列表：无销售单
- ✅ 进货单列表：无进货单
- ✅ 客户管理：无客户
- ✅ 供应商管理：无供应商
- ✅ 仪表盘：所有指标显示为 0

## 代码层面的改进

### 已完成的改进

1. ✅ 移除了所有自动初始化硬编码数据的逻辑
2. ✅ `loadFromStorage` 函数不再自动写入数据
3. ✅ `initData.ts` 文件已不再被使用（但保留作为参考）

### 当前的数据加载逻辑

```typescript
// 从 localStorage 加载数据，不再自动初始化硬编码数据
const loadFromStorage = (key: string, defaultValue: any) => {
  try {
    const item = localStorage.getItem(key)
    if (item) {
      return JSON.parse(item)
    }
    // 如果没有数据，返回默认值（空数组），不自动写入
    return defaultValue
  } catch {
    return defaultValue
  }
}
```

## 注意事项

1. **不同浏览器数据不共享**
   - Chrome 浏览器的数据 ≠ 微信浏览器的数据
   - 每个浏览器都有独立的 localStorage

2. **清除数据不可恢复**
   - 清除 localStorage 后，数据无法恢复
   - 请谨慎操作

3. **新用户首次访问**
   - 新用户首次访问时，所有数据都是空的
   - 这是正常现象，不是 bug

4. **数据持久化**
   - 数据只存储在本地浏览器中
   - 清除浏览器数据会丢失所有数据
   - 建议定期导出重要数据

## 如何确认代码已更新？

### 检查方法 1：查看构建时间

1. 打开项目：`https://alucard672.github.io/shaxian/`
2. 按 F12 打开开发者工具（如果可能）
3. 查看 Network 标签页
4. 查看 JavaScript 文件的修改时间

### 检查方法 2：查看版本号

查看 `VERSION.md` 文件中的最新版本号，确认是否已更新。

### 检查方法 3：查看 GitHub Actions

访问：https://github.com/Alucard672/shaxian/actions

查看最新的部署工作流是否成功完成。





